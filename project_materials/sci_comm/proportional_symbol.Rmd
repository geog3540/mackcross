---
title: "Untitled"
output: html_document
date: "2023-04-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
rm(list=ls())
library(readr)
library(choroplethr)
library(choroplethrMaps)
library(dplyr)
library(ggplot2) 
library(plotly)
library(tmap)
library(sf)
library(tmaptools)

```

## Including Plots

You can also embed plots, for example:

```{r}
my_map <- st_read("shapefiles/iowa_attributes.geojson")
my_data <- data.frame(my_map)

#my_subset <- subset(my_map, CountyName == "polk" & is.na(cleaned_rural_density))
my_map$cleaned_rural_density[is.na(my_map$cleaned_rural_density)] <- 890.120209059234

# my_map <- my_map[complete.cases(my_map$cleaned_rural_density),]

# Convert size variable to numeric and remove missing values
my_map$cleaned_rural_density <- as.numeric(my_map$cleaned_rural_density)
my_map$cleaned_rural_mean_sci <- as.numeric(my_map$cleaned_rural_mean_sci)
my_map$cleaned_rural_CountyGraduateRate4yr <- as.numeric(my_map$cleaned_rural_CountyGraduateRate4yr)
as.numeric(my_map$cleaned_rural_CountySpendingPerStudent)

my_map$binned_science <- as.numeric(my_map$cleaned_rural_mean_sci)
my_map$binned_science <- cut(my_map$cleaned_rural_mean_sci,
                             breaks = c(19, 20, 21, 23),
                             labels = c(1, 2, 3))
my_map$binned_science <- as.numeric(my_map$binned_science)


my_map <- my_map[complete.cases(my_map$cleaned_rural_CountyGraduateRate4yr),]

#palette = c("#a6bddb", "#3690c0", "#034e7b"), 
#palette = c("#8c510a", "#d8b365", "#7fbf7b"),

tm_shape(my_map) +
  tm_fill("cleaned_rural_density", style = "quantile", n = 5, palette = "Greys", title = "Population Density") +
  tm_bubbles(size = "binned_science",
             col = "#034e7b",
             palette = c("#a6bddb", "#3690c0", "#034e7b"), 
             n = 3, 
             alpha = .8, 
             style = "quantile", 
             title.size ="Avg. ACT Science Score", 
             legend.size.is.portrait=TRUE,
             sizes.legend.labels=c("19","20","21","22"), 
             scale = 1.75) +
  #tm_layout(frame = FALSE, bg.color = "black") +
  tm_legend(outside = TRUE, 
            outside.position = "left", 
            bg.color = "transparent", 
            frame = FALSE)

# Create a tooltip that displays the value of cleaned_rural_density on hover
#my_tooltip <- createTooltip(
#  vars = c("cleaned_rural_density"),
#  label = "Population Density: {cleaned_rural_density}"
#)

# Add the tooltip to the map
#tmap_mode("view")
#tm_add_tooltip(my_map, my_tooltip)

# Display the map
#tm_view(my_map)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
